---
title: "8:26:55 PM - November 24, 2025"
date: 2025-11-25T02:26:55.766Z
timestamp: 1764037615766
---

## Project Notes

Fixed "Cannot add new events after calling close" bug in flutter_embedded_nostr_relay package.

Root cause: In subscription.dart, processEvent() called _eventController.add(event) without checking if the controller was closed. When a subscription was closed (user navigated away) but still in _internalSubscriptions map, incoming events would throw.

The error message "[EXTERNAL-EVENT] Failed to store event" was misleading - events WERE stored successfully in SQLite, but the subsequent routing to subscriptions failed.

Fix: Added !_eventController.isClosed checks before .add() and .addError() calls in subscription.dart.

Files changed:
- flutter_embedded_nostr_relay/lib/src/models/subscription.dart
