---
title: "9:04:53 PM - November 24, 2025"
date: 2025-11-25T03:04:53.626Z
timestamp: 1764039893626
---

## Project Notes

Fixed the empty contacts redirect issue in OpenVine. 

**Problem**: Users with no kind 3 contacts (no following list) were being taken to the Home feed by default, which would be empty. They should be redirected to Explore instead.

**Root cause**: The existing redirect logic in `app_router.dart` checked `socialState.isInitialized` before deciding whether to redirect, but the social provider hadn't initialized yet when the redirect fired during app startup.

**Solution**: Changed the redirect to check SharedPreferences cache directly for any `following_list_*` keys with non-empty content, rather than relying on the Riverpod provider state. This is more reliable because:
1. SharedPreferences is synchronous to read (once getInstance is called)
2. The cache persists across app restarts
3. No dependency on provider initialization timing

**Files changed**:
- `lib/router/app_router.dart`: Added `hasAnyFollowingInCache()` function and `resetNavigationState()` for tests
- `test/router/empty_contacts_redirect_test.dart`: New test file with 7 unit tests

**Key learnings**:
- Router redirects need to be self-contained and not rely on provider initialization timing
- SharedPreferences cache is the most reliable source for quick checks during navigation
- The existing router tests were broken due to Firebase initialization issues (pre-existing issue, not related to this change)
