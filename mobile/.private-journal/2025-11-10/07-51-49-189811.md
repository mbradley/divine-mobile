---
title: "7:51:49 AM - November 10, 2025"
date: 2025-11-10T06:51:49.189Z
timestamp: 1762757509189
---

## Project Notes

**Camera Switch Preview Freeze - Complete Investigation Summary**

## Problem Statement
When switching between front/back cameras on iOS, the camera preview shows **one frame from the new camera then freezes**. The preview doesn't continue updating with live video.

## What We've Tried

### 1. State Management Fixes ‚úÖ (Working)
- Added `cameraSwitchCount` to force widget rebuilds
- Verified state updates correctly (logs show `switchCount` incrementing: 0 ‚Üí 1 ‚Üí 2)
- Widget tree IS rebuilding correctly

### 2. Widget Key Strategies ‚úÖ (Working)  
- Added `ValueKey` to force widget destruction/recreation
- Used multiple key locations (screen level + controller level)
- Keys are changing correctly on camera switch

### 3. Latest Attempt ‚è≥ (Testing)
- Added `pausePreview()` / `resumePreview()` calls on iOS after camera initialization
- Theory: Forces iOS to re-bind camera texture to preview widget

## Technical Details

**Evidence from Logs**:
```
üîÑ OLD controller state: isInitialized=true, isRecording=false, isStreaming=false
üîÑ NEW controller initialized: CameraLensDirection.front
üîÑ NEW controller state: isInitialized=true, isRecording=false, isStreaming=false
üì∏ Building camera preview widget (switchCount=1)  ‚Üê Widget IS rebuilding
üì∏ Returning CameraPreview widget with initialized controller for camera 1
```

**Key Observations**:
1. ‚úÖ Camera controller switches correctly (back ‚Üí front)
2. ‚úÖ Widget tree rebuilds (switchCount increments)
3. ‚úÖ New controller is initialized (`isInitialized=true`)
4. ‚ùå Preview shows ONE frame then freezes
5. ‚ö†Ô∏è `isStreaming=false` on both controllers (this is normal - only true when using `startImageStream()`)

**Current Code Flow**:
```dart
// In switchCamera():
1. Set _controller = null
2. Create new CameraController with new camera
3. await controller.initialize()
4. await controller.prepareForVideoRecording()
5. [NEW] await controller.pausePreview() + resumePreview() on iOS
6. Dispose old controller
7. Notify UI to rebuild with new key
```

## Hypothesis
This appears to be an **iOS camera plugin bug** where the native platform view texture doesn't continuously update after a camera switch, despite:
- Controller being properly initialized
- Widget being destroyed and recreated with new key
- Preview widget being rebuilt

The fact that **one frame displays** proves:
- New camera IS capturing
- Texture IS being rendered initially
- Something prevents subsequent frame updates

## Questions for Research

1. **Known Flutter Camera Plugin Issues**:
   - Is there a known bug with camera switching on iOS?
   - Do other developers report "one frame then freeze" behavior?
   - Are there open issues on flutter/plugins camera package?

2. **iOS Platform View Limitations**:
   - Does Flutter's PlatformView have issues with camera texture updates?
   - Is there a known limitation with AVCaptureSession switching?

3. **Workaround Patterns**:
   - What's the recommended approach for camera switching in Flutter on iOS?
   - Do people use different camera plugins (camera_avfoundation, etc.)?
   - Is manual texture recreation required?

4. **Similar Reports**:
   - Search for: "flutter camera switch freeze ios"
   - Search for: "flutter camera preview one frame"
   - Search for: "flutter camera platformview texture not updating"

## Files to Investigate
- `camera` plugin version: 0.11.2 (latest)
- Platform: iOS 18.7.2
- Flutter: Latest stable
- Specific implementation: `camera_avfoundation` (iOS backend)

## Potential Solutions to Research
1. Use `pausePreview()` / `resumePreview()` (currently testing)
2. Recreate CameraController entirely (already doing this)
3. Use different camera plugin (camerawesome, camera_platform_interface)
4. File bug with Flutter team if this is a known limitation
5. Implement workaround: hide preview during switch, show loading indicator
